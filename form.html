<!DOCTYPE html>
<html lang="es">

<head>
    <title>Ingreso Temporal de Vehículos - Aduanas Chile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        .text-aduana {
            color: #0056b3;
        }

        .btn-aduana {
            background-color: #0056b3;
            color: white;
        }

        .step {
            transition: opacity 0.3s ease;
        }

        .is-invalid {
            border-color: #dc3545;
        }

        .invalid-feedback {
            color: #dc3545;
            display: none;
        }

        .is-invalid~.invalid-feedback {
            display: block;
        }

        /* Estilos para el documento de vista previa */
        .documento-preview {
            position: fixed;
            right: 20px;
            top: 150px;
            width: 350px;
            background: white;
            border: 1px solid #ddd;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            z-index: 1000;
        }

        .documento-final {
            max-width: 800px;
            margin: 20px auto;
            background: white;
            border: 1px solid #ddd;
            padding: 30px;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }

        .documento-header {
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .documento-footer {
            border-top: 2px solid #0056b3;
            padding-top: 20px;
            margin-top: 30px;
        }

        .form-container {
            display: flex;
            justify-content: space-between;
        }

        .form-content {
            width: 65%;
        }

        .preview-container {
            width: 33%;
            position: relative;
        }

        .form-container.step3-active .form-content {
            width: 100%;
        }

        .form-container.step3-active .preview-container {
            display: none;
        }
    </style>
</head>

<body>
    <nav class="navbar px-3">
        <div class="container-fluid d-flex justify-content-between align-items-center">
            <img src="src/gobierno.png" style="height: 110px;" alt="Gobierno">
            <img src="src/aduana.jpg" style="height: 110px;" alt="Aduana">
        </div>
    </nav>

    <div class="container py-5">
        <div class="form-container">
            <div class="form-content">
                <div class="mx-auto">
                    <div class="card shadow-sm border-0 rounded-4">
                        <div class="card-body p-5">
                            <div class="mb-4 text-center">
                                <h2 class="fw-bold text-aduana">Ingreso Temporal de Vehículos</h2>
                                <p class="text-muted">Paso <span id="step-indicator">1</span> de 3</p>
                            </div>

                            <form id="wizardForm" novalidate>
                                <!-- Paso 1 -->
                                <div class="step" id="step1">
                                    <h5 class="mb-3">Paso 1: Datos personales</h5>
                                    <div class="mb-4">
                                        <label class="form-label fw-semibold">Tipo de persona <span
                                                class="text-danger">*</span></label>
                                        <div class="d-flex gap-4">
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="personaTipo"
                                                    value="Propietario" required>
                                                <label class="form-check-label">Propietario</label>
                                            </div>
                                            <div class="form-check">
                                                <input class="form-check-input" type="radio" name="personaTipo"
                                                    value="Autorizado">
                                                <label class="form-check-label">Autorizado</label>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback">Seleccione un tipo de persona</div>
                                    </div>

                                    <div id="adjuntoPermiso" class="mb-4 d-none">
                                        <label class="form-label fw-semibold">Adjuntar poder notarial en formato PDF
                                            <span class="text-danger">*</span></label>
                                        <input type="file" class="form-control" id="archivoPermiso" accept=".pdf">
                                        <div class="invalid-feedback">Debe adjuntar el documento de autorización</div>
                                    </div>

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Apellido Paterno <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="apellidoPaterno" required
                                                pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
                                                title="Solo se permiten letras (no números)">
                                            <div class="invalid-feedback">Solo se permiten letras (no números)</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Apellido Materno <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="apellidoMaterno" required
                                                pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
                                                title="Solo se permiten letras (no números)">
                                            <div class="invalid-feedback">Solo se permiten letras (no números)</div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label fw-semibold">Nombres <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="nombres" required
                                                pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
                                                title="Solo se permiten letras (no números)">
                                            <div class="invalid-feedback">Solo se permiten letras (no números)</div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label">Dirección</label>
                                            <input type="text" class="form-control" name="direccion">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label fw-semibold">Nacionalidad <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="nacionalidad" value="Chilena"
                                                required>
                                            <div class="invalid-feedback">Campo obligatorio</div>
                                        </div>
                                    </div>

                                    <hr class="my-4" />

                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Tipo de documento <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select" name="tipoDocumento" required>
                                                <option value="" selected disabled>Seleccione</option>
                                                <option value="Cédula">Cédula de Identidad</option>
                                                <option value="Pasaporte">Pasaporte</option>
                                            </select>
                                            <div class="invalid-feedback">Seleccione un tipo de documento</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">Número <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="numeroDocumento"
                                                id="numeroDocumento" required disabled>
                                            <div class="invalid-feedback" id="numeroDocumentoFeedback">Seleccione
                                                primero el
                                                tipo de documento</div>
                                        </div>
                                        <div class="col-md-12">
                                            <label class="form-label fw-semibold">Cantidad de pasajeros <span
                                                    class="text-danger">*</span></label>
                                            <input type="number" class="form-control" name="pasajeros" min="0" required>
                                            <div class="invalid-feedback">Campo obligatorio</div>
                                        </div>
                                    </div>

                                    <div class="mt-5 d-flex justify-content-end">
                                        <button type="button" class="btn btn-aduana"
                                            onclick="validateStep1()">Siguiente</button>
                                    </div>
                                </div>

                                <!-- Paso 2 -->
                                <div class="step d-none" id="step2">
                                    <h5 class="mb-3">Paso 2: Datos del vehículo</h5>

                                    <!-- Selección de tipo de vehículo -->
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">Tipo de vehículo <span
                                                class="text-danger">*</span></label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Auto" required>
                                                    <label class="form-check-label">Auto</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Jeep">
                                                    <label class="form-check-label">Jeep</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Camioneta">
                                                    <label class="form-check-label">Camioneta</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Motocicleta">
                                                    <label class="form-check-label">Motocicleta</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Motor Home">
                                                    <label class="form-check-label">Motor Home</label>
                                                </div>
                                                <div class="form-check">
                                                    <input class="form-check-input" type="radio" name="tipoVehiculo"
                                                        value="Otro">
                                                    <label class="form-check-label">Otro</label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback">Seleccione un tipo de vehículo</div>
                                    </div>

                                    <!-- Vehículo de arrastre -->
                                    <div class="mb-3">
                                        <label class="form-label fw-semibold">¿Vehículo de arrastre? <span
                                                class="text-danger">*</span></label>
                                        <div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="arrastre" value="Sí"
                                                    required>
                                                <label class="form-check-label">Sí</label>
                                            </div>
                                            <div class="form-check form-check-inline">
                                                <input class="form-check-input" type="radio" name="arrastre" value="No">
                                                <label class="form-check-label">No</label>
                                            </div>
                                        </div>
                                        <div class="invalid-feedback">Seleccione una opción</div>
                                    </div>

                                    <!-- Datos del vehículo -->
                                    <div class="row">
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label fw-semibold">Chasis / VIN <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="chasis" required>
                                            <div class="invalid-feedback">Campo obligatorio</div>
                                        </div>

                                        <!-- Menú desplegable de marcas -->
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label fw-semibold">Marca <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select" name="marca" id="marcaVehiculo" required>
                                                <option value="" selected disabled>Seleccione una marca</option>
                                                <option value="Toyota">Toyota</option>
                                                <option value="Hyundai">Hyundai</option>
                                                <option value="Kia">Kia</option>
                                                <option value="Chevrolet">Chevrolet</option>
                                                <option value="Nissan">Nissan</option>
                                                <option value="Mitsubishi">Mitsubishi</option>
                                                <option value="Ford">Ford</option>
                                                <option value="Volkswagen">Volkswagen</option>
                                                <option value="Honda">Honda</option>
                                                <option value="Mazda">Mazda</option>
                                                <option value="Suzuki">Suzuki</option>
                                                <option value="Subaru">Subaru</option>
                                                <option value="Jeep">Jeep</option>
                                                <option value="BMW">BMW</option>
                                                <option value="Mercedes-Benz">Mercedes-Benz</option>
                                                <option value="Audi">Audi</option>
                                                <option value="Lexus">Lexus</option>
                                                <option value="Volvo">Volvo</option>
                                                <option value="Peugeot">Peugeot</option>
                                                <option value="Renault">Renault</option>
                                                <option value="Otra">Otra marca</option>
                                            </select>
                                            <div class="invalid-feedback">Seleccione una marca</div>
                                        </div>

                                        <!-- Menú desplegable de modelos -->
                                        <div class="col-md-4 mb-3">
                                            <label class="form-label fw-semibold">Modelo <span
                                                    class="text-danger">*</span></label>
                                            <select class="form-select" name="modelo" id="modeloVehiculo" required
                                                disabled>
                                                <option value="" selected disabled>Primero seleccione una marca</option>
                                            </select>
                                            <div class="invalid-feedback">Seleccione un modelo</div>
                                        </div>

                                        <div class="col-md-4 mb-3">
                                            <label class="form-label fw-semibold">Patente <span
                                                    class="text-danger">*</span></label>
                                            <input type="text" class="form-control" name="patente" required>
                                            <div class="invalid-feedback">Campo obligatorio</div>
                                        </div>
                                    </div>

                                    <!-- Campo para especificar otra marca -->
                                    <div class="mb-3" id="otraMarcaContainer" style="display: none;">
                                        <label class="form-label fw-semibold">Especifique la marca <span
                                                class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="otraMarca">
                                        <div class="invalid-feedback">Ingrese la marca del vehículo</div>
                                    </div>

                                    <div class="mt-4 d-flex justify-content-between">
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="prevStep()">Atrás</button>
                                        <button type="button" class="btn btn-aduana"
                                            onclick="validateStep2()">Siguiente</button>
                                    </div>
                                </div>

                                <!-- Paso 3 -->
                                <div class="step d-none" id="step3">
                                    <h5 class="mb-3">Paso 3: Confirmación</h5>

                                    <!-- Documento final -->
                                    <div class="documento-final">
                                        <div class="documento-header text-center">
                                            <h4 class="fw-bold text-aduana">Ingreso Temporal de Vehículos</h4>
                                            <p class="text-muted">Aduanas de Chile</p>
                                        </div>

                                        <div id="documento-final-content">
                                            <!-- Aquí se insertará el contenido del documento -->
                                        </div>

                                        <div class="documento-footer">
                                            <div class="alert alert-warning">
                                                Declaro conocer las normas aduaneras vigentes en la República Argentina
                                                y la
                                                República de Chile, y me comprometo a retornar el vehículo dentro del
                                                plazo autorizado.
                                            </div>

                                            <div class="form-check mb-3">
                                                <input class="form-check-input" type="checkbox" id="declaracionCheck"
                                                    required>
                                                <label class="form-check-label" for="declaracionCheck">
                                                    Acepto la declaración y condiciones. <span
                                                        class="text-danger">*</span>
                                                </label>
                                                <div class="invalid-feedback">Debe aceptar los términos</div>
                                            </div>

                                            <div class="mb-3">
                                                <label class="form-label">Observaciones</label>
                                                <textarea class="form-control" rows="3" name="observaciones"></textarea>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-4 d-flex justify-content-between">
                                        <button type="button" class="btn btn-outline-secondary"
                                            onclick="prevStep()">Atrás</button>
                                        <button type="submit" class="btn btn-success">Enviar Formulario</button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Documento de vista previa -->
            <div class="preview-container">
                <div class="documento-preview">
                    <div class="documento-header text-center">
                        <h5 class="fw-bold text-aduana">Vista Previa</h5>
                        <p class="text-muted small">Aduanas de Chile</p>
                    </div>

                    <div id="documento-preview-content">
                        <p><strong>Nombre Completo:</strong> <span id="preview-nombre">-</span></p>
                        <p><strong>RUN/Pasaporte:</strong> <span id="preview-documento">-</span></p>
                        <p><strong>Nacionalidad:</strong> <span id="preview-nacionalidad">-</span></p>
                        <p><strong>Dirección:</strong> <span id="preview-direccion">-</span></p>
                        <p><strong>Tipo de Vehículo:</strong> <span id="preview-tipo-vehiculo">-</span></p>
                        <p><strong>Chasis/VIN:</strong> <span id="preview-chasis">-</span></p>
                        <p><strong>Marca:</strong> <span id="preview-marca">-</span></p>
                        <p><strong>Modelo:</strong> <span id="preview-modelo">-</span></p>
                        <p><strong>Patente:</strong> <span id="preview-patente">-</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;

        // Base de datos de modelos por marca
        const modelosPorMarca = {
            "Toyota": ["Corolla", "Yaris", "Camry", "RAV4", "Hilux", "Fortuner", "Prius", "Land Cruiser", "Prado", "Hiace", "Avanza", "Rush", "Innova", "C-HR", "Highlander", "Tacoma", "4Runner", "Tundra", "Sequoia", "Sienna"],
            "Hyundai": ["Accent", "Elantra", "Tucson", "Santa Fe", "Kona", "Creta", "Venue", "Palisade", "Sonata", "i10", "i20", "i30", "Veloster", "Genesis", "Ioniq", "Nexo", "Staria", "H-1", "Grand i10", "Grand i20"],
            "Kia": ["Rio", "Cerato", "Optima", "Sorento", "Sportage", "Picanto", "Stonic", "Seltos", "Carnival", "Niro", "Soul", "Forte", "Cadenza", "K5", "K7", "K9", "Telluride", "EV6", "Mohave", "Bongo"],
            "Chevrolet": ["Spark", "Aveo", "Cruze", "Malibu", "Camaro", "Corvette", "Trax", "Tracker", "Equinox", "Blazer", "Tahoe", "Suburban", "Silverado", "Colorado", "Sonic", "Onix", "Prisma", "Spin", "Orlando", "Captiva"],
            "Nissan": ["Versa", "Sentra", "Altima", "Maxima", "March", "Kicks", "Qashqai", "X-Trail", "Rogue", "Pathfinder", "Murano", "Armada", "Frontier", "Navara", "Patrol", "Juke", "Leaf", "370Z", "GT-R", "NV200"],
            "Mitsubishi": ["Mirage", "Attrage", "Lancer", "Outlander", "ASX", "Eclipse Cross", "Pajero", "Montero Sport", "Triton", "L200", "XPander", "Delica", "Pajero Sport", "i-MiEV", "Space Star", "Grandis", "Colt", "Galant", "RVR", "Chariot"],
            "Ford": ["Fiesta", "Focus", "Fusion", "Mustang", "EcoSport", "Escape", "Edge", "Explorer", "Expedition", "Ranger", "F-150", "F-250", "F-350", "Transit", "Transit Connect", "Bronco", "Bronco Sport", "Maverick", "Territory", "Everest"],
            "Volkswagen": ["Gol", "Polo", "Vento", "Jetta", "Passat", "Arteon", "T-Cross", "T-Roc", "Tiguan", "Touareg", "Atlas", "Amarok", "Saveiro", "Golf", "Beetle", "ID.4", "ID.3", "Caddy", "Crafter", "Transporter"],
            "Honda": ["Fit", "City", "Civic", "Accord", "HR-V", "CR-V", "Pilot", "Odyssey", "BR-V", "WR-V", "Brio", "Amaze", "Jazz", "Legend", "NSX", "Ridgeline", "Passport", "Stepwgn", "Freed", "Mobilio"],
            "Mazda": ["2", "3", "6", "CX-3", "CX-30", "CX-5", "CX-9", "MX-5", "BT-50", "CX-8", "CX-4", "RX-8", "RX-7", "323", "626", "929", "MPV", "Bongo", "Tribute", "Demio"],
            "Suzuki": ["Alto", "Celerio", "Swift", "Baleno", "Dzire", "Ignis", "Jimny", "Vitara", "S-Cross", "XL7", "Carry", "APV", "Ertiga", "Landy", "Samurai", "Grand Vitara", "Kizashi", "SX4", "Wagon R", "Ciaz"],
            "Subaru": ["Impreza", "Legacy", "Outback", "Forester", "XV", "BRZ", "WRX", "Ascent", "Levorg", "Tribeca", "Baja", "SVX", "Justy", "Trezia", "Dex", "Pleo", "Stella", "R1", "R2", "Exiga"],
            "Jeep": ["Renegade", "Compass", "Cherokee", "Grand Cherokee", "Wrangler", "Gladiator", "Wagoneer", "Commander", "Liberty", "Patriot", "Comanche", "CJ", "Willys", "Grand Wagoneer", "FC", "DJ", "Forward Control", "J-Series", "Kaiser", "Dispatcher"],
            "BMW": ["Serie 1", "Serie 2", "Serie 3", "Serie 4", "Serie 5", "Serie 7", "Serie 8", "X1", "X2", "X3", "X4", "X5", "X6", "X7", "Z4", "i3", "i4", "i8", "M2", "M3"],
            "Mercedes-Benz": ["Clase A", "Clase B", "Clase C", "Clase E", "Clase S", "CLA", "CLS", "GLA", "GLB", "GLC", "GLE", "GLS", "G", "EQC", "EQA", "EQB", "EQE", "EQS", "AMG GT", "Maybach"],
            "Audi": ["A1", "A3", "A4", "A5", "A6", "A7", "A8", "Q2", "Q3", "Q5", "Q7", "Q8", "e-tron", "TT", "R8", "RS3", "RS4", "RS5", "RS6", "RS7"],
            "Lexus": ["CT", "IS", "ES", "GS", "LS", "UX", "NX", "RX", "GX", "LX", "RC", "LC", "LFA", "HS", "SC", "RX L", "NX L", "UX L", "ES L", "LS L"],
            "Volvo": ["S40", "S60", "S80", "S90", "V40", "V60", "V90", "XC40", "XC60", "XC90", "C30", "C40", "C70", "V50", "V70", "XC70", "S70", "850", "940", "240"],
            "Peugeot": ["108", "208", "308", "408", "508", "2008", "3008", "5008", "Rifter", "Partner", "Expert", "Boxer", "Traveller", "iOn", "e-208", "e-2008", "RCZ", "4008", "5008", "607"],
            "Renault": ["Kwid", "Sandero", "Logan", "Clio", "Megane", "Talisman", "Captur", "Kadjar", "Koleos", "Duster", "Oroch", "Alaskan", "Master", "Trafic", "Kangoo", "Zoe", "Twingo", "Fluence", "Latitude", "Safrane"]
        };

        // Función para cargar modelos según la marca seleccionada
        document.getElementById('marcaVehiculo').addEventListener('change', function () {
            const marcaSeleccionada = this.value;
            const selectModelo = document.getElementById('modeloVehiculo');

            // Limpiar opciones anteriores
            selectModelo.innerHTML = '<option value="" selected disabled>Seleccione un modelo</option>';

            if (marcaSeleccionada && marcaSeleccionada !== 'Otra') {
                // Habilitar select de modelo
                selectModelo.disabled = false;

                // Agregar modelos correspondientes
                modelosPorMarca[marcaSeleccionada].forEach(modelo => {
                    const option = document.createElement('option');
                    option.value = modelo;
                    option.textContent = modelo;
                    selectModelo.appendChild(option);
                });
            } else {
                // Deshabilitar si no hay marca seleccionada o es "Otra"
                selectModelo.disabled = true;
            }

            actualizarVistaPrevia();
        });

        // Actualizar vista previa cuando cambia el modelo
        document.getElementById('modeloVehiculo').addEventListener('change', actualizarVistaPrevia);

        // Mostrar paso actual
        function showStep(step) {
            document.querySelectorAll('.step').forEach((el, i) => {
                el.classList.toggle('d-none', i !== step - 1);
            });
            document.getElementById("step-indicator").textContent = step;
            currentStep = step;

            // Controlar el layout para el paso 3
            const formContainer = document.querySelector('.form-container');
            if (step === 3) {
                formContainer.classList.add('step3-active');
                actualizarDocumentoFinal();
            } else {
                formContainer.classList.remove('step3-active');
                actualizarVistaPrevia();
            }
        }

        // Función para actualizar la vista previa del documento
        function actualizarVistaPrevia() {
            // Datos personales
            const apellidoPaterno = document.querySelector('input[name="apellidoPaterno"]').value || '';
            const apellidoMaterno = document.querySelector('input[name="apellidoMaterno"]').value || '';
            const nombres = document.querySelector('input[name="nombres"]').value || '';
            const nombreCompleto = `${nombres} ${apellidoPaterno} ${apellidoMaterno}`.trim();

            // Documento
            const tipoDoc = document.querySelector('select[name="tipoDocumento"]').value || '';
            const numeroDoc = document.querySelector('input[name="numeroDocumento"]').value || '';
            const documento = tipoDoc && numeroDoc ? `${tipoDoc}: ${numeroDoc}` : '-';

            // Otros datos
            const nacionalidad = document.querySelector('input[name="nacionalidad"]').value || '-';
            const direccion = document.querySelector('input[name="direccion"]').value || '-';

            // Datos del vehículo
            const tipoVehiculo = document.querySelector('input[name="tipoVehiculo"]:checked') ?
                document.querySelector('input[name="tipoVehiculo"]:checked').value : '-';
            const chasis = document.querySelector('input[name="chasis"]').value || '-';
            const marca = document.querySelector('select[name="marca"]').value === 'Otra' ?
                document.querySelector('input[name="otraMarca"]').value || '-' :
                document.querySelector('select[name="marca"]').value || '-';
            const modelo = document.getElementById('modeloVehiculo').value || '-';
            const patente = document.querySelector('input[name="patente"]').value || '-';


            // Actualizar los elementos de vista previa
            document.getElementById('preview-nombre').textContent = nombreCompleto || '-';
            document.getElementById('preview-documento').textContent = documento;
            document.getElementById('preview-nacionalidad').textContent = nacionalidad;
            document.getElementById('preview-direccion').textContent = direccion;
            document.getElementById('preview-tipo-vehiculo').textContent = tipoVehiculo;
            document.getElementById('preview-chasis').textContent = chasis;
            document.getElementById('preview-marca').textContent = marca;
            document.getElementById('preview-modelo').textContent = modelo;
            document.getElementById('preview-patente').textContent = patente;
        }

        // Función para actualizar el documento final en el paso 3
        function actualizarDocumentoFinal() {
            const docContent = document.getElementById('documento-final-content');

            // Datos personales
            const apellidoPaterno = document.querySelector('input[name="apellidoPaterno"]').value || '';
            const apellidoMaterno = document.querySelector('input[name="apellidoMaterno"]').value || '';
            const nombres = document.querySelector('input[name="nombres"]').value || '';
            const nombreCompleto = `${nombres} ${apellidoPaterno} ${apellidoMaterno}`.trim();

            // Documento
            const tipoDoc = document.querySelector('select[name="tipoDocumento"]').value || '';
            const numeroDoc = document.querySelector('input[name="numeroDocumento"]').value || '';
            const documento = tipoDoc && numeroDoc ? `${tipoDoc}: ${numeroDoc}` : '-';

            // Otros datos
            const nacionalidad = document.querySelector('input[name="nacionalidad"]').value || '-';
            const direccion = document.querySelector('input[name="direccion"]').value || '-';
            const pasajeros = document.querySelector('input[name="pasajeros"]').value || '0';

            // Datos del vehículo
            const tipoVehiculo = document.querySelector('input[name="tipoVehiculo"]:checked') ?
                document.querySelector('input[name="tipoVehiculo"]:checked').value : '-';
            const arrastre = document.querySelector('input[name="arrastre"]:checked') ?
                document.querySelector('input[name="arrastre"]:checked').value : '-';
            const chasis = document.querySelector('input[name="chasis"]').value || '-';
            const marca = document.querySelector('select[name="marca"]').value === 'Otra' ?
                document.querySelector('input[name="otraMarca"]').value || '-' :
                document.querySelector('select[name="marca"]').value || '-';
            const modelo = document.getElementById('modeloVehiculo').value || '-';
            const patente = document.querySelector('input[name="patente"]').value || '-';

            // Construir el HTML del documento final
            docContent.innerHTML = `
        <div class="mb-4">
            <h5 class="fw-bold">Datos del Solicitante</h5>
            <p><strong>Nombre Completo:</strong> ${nombreCompleto || '-'}</p>
            <p><strong>${tipoDoc || 'Documento'}:</strong> ${numeroDoc || '-'}</p>
            <p><strong>Nacionalidad:</strong> ${nacionalidad}</p>
            <p><strong>Dirección:</strong> ${direccion}</p>
        </div>
        
        <div class="mb-4">
            <h5 class="fw-bold">Datos del Vehículo</h5>
            <p><strong>Tipo de Vehículo:</strong> ${tipoVehiculo}</p>
            <p><strong>Vehículo de arrastre:</strong> ${arrastre}</p>
            <p><strong>Chasis/VIN:</strong> ${chasis}</p>
            <p><strong>Marca:</strong> ${marca}</p>
            <p><strong>Modelo:</strong> ${modelo}</p>
            <p><strong>Patente:</strong> ${patente}</p>
            <p><strong>Cantidad de pasajeros:</strong> ${pasajeros}</p>
        </div>
    `;
        }

        // Validación del Paso 1
        function validateStep1() {
            const form = document.getElementById('wizardForm');
            const step1Inputs = document.querySelectorAll('#step1 [required]');
            let isValid = true;

            step1Inputs.forEach(input => {
                // Validar campos obligatorios
                if ((input.type !== 'radio' && !input.value) ||
                    (input.type === 'radio' && !document.querySelector(`input[name="${input.name}"]:checked`))) {
                    input.classList.add('is-invalid');
                    isValid = false;
                } else {
                    // Validar pattern para nombres y apellidos
                    if (input.hasAttribute('pattern')) {
                        const regex = new RegExp(input.getAttribute('pattern'));
                        if (!regex.test(input.value)) {
                            input.classList.add('is-invalid');
                            isValid = false;
                            return;
                        }
                    }
                    input.classList.remove('is-invalid');
                }
            });

            // Validación adicional para el número de documento
            const tipoDoc = document.querySelector('select[name="tipoDocumento"]').value;
            const numeroDoc = document.getElementById('numeroDocumento');

            if (tipoDoc && !numeroDoc.value) {
                numeroDoc.classList.add('is-invalid');
                isValid = false;
            }
            else if (tipoDoc === 'Cédula' && !/^\d{1,2}\.\d{3}\.\d{3}-[0-9kK]$/.test(numeroDoc.value)) {
                numeroDoc.classList.add('is-invalid');
                isValid = false;
            }
            else if (tipoDoc === 'Pasaporte' && !/^[A-Za-z]{0,2}[0-9]{6,8}$/.test(numeroDoc.value)) {
                numeroDoc.classList.add('is-invalid');
                isValid = false;
            }

            // Agregar esta parte para avanzar si todo es válido
            if (isValid) {
                nextStep();
            } else {
                const firstInvalid = document.querySelector('#step1 .is-invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
        }

        // Validación del Paso 2
        function validateStep2() {
            const form = document.getElementById('wizardForm');
            const step2Inputs = document.querySelectorAll('#step2 [required]');
            let isValid = true;

            // Validar patente primero
            const patenteInput = document.querySelector('input[name="patente"]');
            if (!validarPatente(patenteInput)) {
                isValid = false;
            }

            step2Inputs.forEach(input => {
                if (!input.value && !(input.type === 'radio' && document.querySelector(`input[name="${input.name}"]:checked`))) {
                    input.classList.add('is-invalid');
                    isValid = false;
                } else {
                    input.classList.remove('is-invalid');
                }
            });

            // Validación especial para "Otra marca"
            const marcaSelect = document.querySelector('select[name="marca"]');
            if (marcaSelect.value === 'Otra' && !document.querySelector('input[name="otraMarca"]').value) {
                document.querySelector('input[name="otraMarca"]').classList.add('is-invalid');
                isValid = false;
            }

            // Validar que se haya seleccionado un modelo si la marca no es "Otra"
            if (marcaSelect.value && marcaSelect.value !== 'Otra' && !document.getElementById('modeloVehiculo').value) {
                document.getElementById('modeloVehiculo').classList.add('is-invalid');
                isValid = false;
            }

            if (isValid) {
                nextStep();
            } else {
                const firstInvalid = document.querySelector('#step2 .is-invalid');
                if (firstInvalid) {
                    firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }



        }

        function nextStep() {
            if (currentStep < 3) showStep(currentStep + 1);
        }

        function prevStep() {
            if (currentStep > 1) showStep(currentStep - 1);
        }

        // Mostrar campo para adjuntar permiso cuando sea necesario
        document.querySelectorAll('input[name="personaTipo"]').forEach((radio) => {
            radio.addEventListener('change', function () {
                const adjunto = document.getElementById('adjuntoPermiso');
                const inputArchivo = document.getElementById('archivoPermiso');
                if (this.value === 'Autorizado') {
                    adjunto.classList.remove('d-none');
                    inputArchivo.required = true;
                } else {
                    adjunto.classList.add('d-none');
                    inputArchivo.required = false;
                }
            });
        });

        // Mostrar campo "Otra marca" cuando corresponda
        document.querySelector('select[name="marca"]').addEventListener('change', function () {
            const otraMarcaContainer = document.getElementById('otraMarcaContainer');
            otraMarcaContainer.style.display = this.value === 'Otra' ? 'block' : 'none';

            if (this.value !== 'Otra') {
                document.querySelector('input[name="otraMarca"]').value = '';
                document.querySelector('input[name="otraMarca"]').classList.remove('is-invalid');
            }

            actualizarVistaPrevia();
        });

        // Manejar envío del formulario
        document.getElementById("wizardForm").addEventListener("submit", function (e) {
            e.preventDefault();

            // Validar checkbox de declaración
            const declaracionCheck = document.getElementById('declaracionCheck');
            if (!declaracionCheck.checked) {
                declaracionCheck.classList.add('is-invalid');
                return;
            }

            // Mostrar datos en consola (simulación de envío)
            const formData = new FormData(this);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });

            console.log("Datos del formulario:", data);
            alert("Formulario enviado correctamente.\n\nRevise la consola para ver los datos simulados.");
            this.reset();
            showStep(1);
        });

        // Event listeners para actualizar la vista previa en tiempo real
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('input', actualizarVistaPrevia);
            element.addEventListener('change', actualizarVistaPrevia);
        });

        // Validación del RUT
        function validarDigitoVerificador(rutCompleto) {
            // Limpiar el RUT y separar número de dígito verificador
            const rutLimpio = rutCompleto.replace(/[^0-9kK]/g, '');
            const numero = rutLimpio.slice(0, -1);
            const dv = rutLimpio.slice(-1).toUpperCase();

            // Calcular dígito verificador esperado
            let suma = 0;
            let multiplicador = 2;

            for (let i = numero.length - 1; i >= 0; i--) {
                suma += parseInt(numero.charAt(i)) * multiplicador;
                multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
            }

            const dvEsperado = 11 - (suma % 11);
            let dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'K' : dvEsperado.toString();

            return dvCalculado === dv;
        }

        /* ========== FORMATEO AUTOMÁTICO DE PATENTE CHILENA ========== */
        document.querySelector('input[name="patente"]').addEventListener('input', function (e) {
            // Guardar posición del cursor
            const startPos = this.selectionStart;
            const endPos = this.selectionEnd;

            // Obtener valor sin formato y convertir a mayúsculas
            let value = this.value.replace(/[^a-zA-Z0-9]/g, '').toUpperCase();

            // Aplicar formato progresivo
            if (value.length > 0) {
                let formattedValue = '';

                // Primeras 2 letras (BB)
                if (value.length > 0) {
                    formattedValue = value.substring(0, 2);
                }

                // Agregar guión después de 2 letras (BB-)
                if (value.length > 2) {
                    formattedValue += '-' + value.substring(2, 4);
                }

                // Agregar punto medio después de 4 letras (BB-CC·)
                if (value.length > 4) {
                    formattedValue += '·' + value.substring(4, 6);
                }

                // Limitar a 6 caracteres (4 letras + 2 números)
                if (value.length > 6) {
                    value = value.substring(0, 6);
                    formattedValue = formattedValue.substring(0, 8); // BB-CC·12
                }

                this.value = formattedValue;

                // Ajustar posición del cursor
                let newPos = startPos;
                if (startPos >= 2 && value.length >= 2) newPos++;
                if (startPos >= 4 && value.length >= 4) newPos++;
                if (startPos >= 6 && value.length >= 6) newPos++;

                this.setSelectionRange(newPos, newPos);
            }

            // Validar formato mientras se escribe
            validarPatente(this);
            actualizarVistaPrevia();
        });

        // Validación de patente al perder foco
        document.querySelector('input[name="patente"]').addEventListener('blur', function () {
            validarPatente(this);
            actualizarVistaPrevia();
        });

        // Función para validar el formato de la patente
        function validarPatente(input) {
            const patenteRegex = /^[A-Z]{2}-[A-Z]{2}·\d{2}$/;
            if (patenteRegex.test(input.value)) {
                input.classList.remove('is-invalid');
                return true;
            } else {
                // Mostrar error solo si hay contenido pero no cumple el formato
                if (input.value.trim() !== '') {
                    input.classList.add('is-invalid');
                    // Mostrar mensaje de ayuda
                    const feedback = input.nextElementSibling;
                    if (feedback && feedback.classList.contains('invalid-feedback')) {
                        feedback.textContent = 'Formato inválido. Debe ser: BB-CC·12 (4 letras y 2 números)';
                    }
                } else {
                    input.classList.remove('is-invalid');
                }
                return false;
            }
        }

        /* ========== FORMATEO AUTOMÁTICO DE RUN ========== */
        document.getElementById('numeroDocumento').addEventListener('input', function (e) {
            const tipoDoc = document.querySelector('select[name="tipoDocumento"]').value;

            // Solo aplicar formateo si es RUN (Cédula)
            if (tipoDoc === 'Cédula') {
                // Guardar posición del cursor
                const startPos = this.selectionStart;
                const endPos = this.selectionEnd;

                // Obtener valor sin formato
                let value = this.value.replace(/[^0-9kK]/g, '').toUpperCase();

                // Aplicar formato progresivo
                if (value.length > 1) {
                    const dv = value.slice(-1);
                    let body = value.slice(0, -1).replace(/\D/g, '');

                    // Aplicar formato parcial mientras se escribe
                    if (body.length > 0) {
                        // Formatear según la longitud del cuerpo
                        let formattedBody = '';
                        if (body.length <= 3) {
                            formattedBody = body;
                        } else if (body.length <= 6) {
                            formattedBody = body.slice(0, -3) + '.' + body.slice(-3);
                        } else {
                            formattedBody = body.slice(0, -6) + '.' + body.slice(-6, -3) + '.' + body.slice(-3);
                        }
                        this.value = formattedBody + '-' + dv;

                        // Restaurar posición del cursor (ajustada por los caracteres agregados)
                        const addedChars = (this.value.match(/\./g) || []).length;
                        this.setSelectionRange(startPos + addedChars, endPos + addedChars);
                    }
                }

                // Mostrar como válido mientras se escribe (validación estricta solo al perder foco)
                this.classList.remove('is-invalid');
            }

            actualizarVistaPrevia();
        });

        // Validación al perder foco
        document.getElementById('numeroDocumento').addEventListener('blur', function () {
            const tipoDoc = document.querySelector('select[name="tipoDocumento"]').value;

            if (tipoDoc === 'Cédula') {
                const runRegex = /^(\d{1,2})\.(\d{3})\.(\d{3})-([0-9kK])$/;
                if (!runRegex.test(this.value)) {
                    this.classList.add('is-invalid');
                } else {
                    // Validar dígito verificador
                    if (!validarDigitoVerificador(this.value)) {
                        this.classList.add('is-invalid');
                        document.getElementById('numeroDocumentoFeedback').textContent = 'RUN inválido: dígito verificador incorrecto';
                    } else {
                        this.classList.remove('is-invalid');
                    }
                }
            }
            else if (tipoDoc === 'Pasaporte') {
                const pasaporteRegex = /^[A-Za-z]{0,2}[0-9]{6,8}$/;
                if (!pasaporteRegex.test(this.value)) {
                    this.classList.add('is-invalid');
                }
            }

            actualizarVistaPrevia();
        });

        /* ========== HABILITAR CAMPO NÚMERO AL SELECCIONAR TIPO DOCUMENTO ========== */
        document.querySelector('select[name="tipoDocumento"]').addEventListener('change', function () {
            const numeroInput = document.getElementById('numeroDocumento');

            if (this.value) {
                numeroInput.disabled = false;
                numeroInput.focus(); // Opcional: lleva el foco al campo automáticamente
            } else {
                numeroInput.disabled = true;
                numeroInput.value = ''; // Limpiar el campo si se deselecciona
            }

            actualizarVistaPrevia();
        });

        // Validación adicional para asegurar que el tipo de documento esté seleccionado
        document.getElementById('numeroDocumento').addEventListener('focus', function () {
            const tipoDocSelect = document.querySelector('select[name="tipoDocumento"]');
            if (!tipoDocSelect.value) {
                tipoDocSelect.focus();
                tipoDocSelect.classList.add('is-invalid');
            }
        });

        // Inicializar la vista previa
        actualizarVistaPrevia();


        /* ========== VALIDACIÓN EN TIEMPO REAL PARA CAMPOS DE TEXTO ========== */
        const camposTexto = document.querySelectorAll(
            'input[name="apellidoPaterno"], input[name="apellidoMaterno"], input[name="nombres"]'
        );

        camposTexto.forEach(input => {
            input.addEventListener('input', function () {
                // Limpiar el error cuando el usuario comienza a escribir
                this.classList.remove('is-invalid');

                // Validar solo si hay contenido
                if (this.value.trim() !== '') {
                    const regex = /^[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+$/;
                    if (!regex.test(this.value)) {
                        this.classList.add('is-invalid');
                    }
                }

                actualizarVistaPrevia();
            });
        });

        /* ========== VALIDACIÓN EN TIEMPO REAL PARA RADIOS Y CHECKBOXES ========== */
        document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('change', function () {
                // Remover errores de todos los radios/checkboxes del mismo grupo
                document.querySelectorAll(`input[name="${this.name}"]`).forEach(el => {
                    el.classList.remove('is-invalid');
                });
                actualizarVistaPrevia();
            });
        });

        /* ========== VALIDACIÓN EN TIEMPO REAL PARA SELECTS ========== */
        document.querySelectorAll('select').forEach(select => {
            select.addEventListener('change', function () {
                this.classList.remove('is-invalid');
                actualizarVistaPrevia();

                // Caso especial para el tipo de documento
                if (this.name === 'tipoDocumento') {
                    const numeroInput = document.getElementById('numeroDocumento');
                    if (this.value) {
                        numeroInput.disabled = false;
                        numeroInput.focus();
                    } else {
                        numeroInput.disabled = true;
                        numeroInput.value = '';
                    }
                }
            });
        });

        /* ========== VALIDACIÓN EN TIEMPO REAL PARA CAMPOS NUMÉRICOS ========== */
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function () {
                this.classList.remove('is-invalid');
                actualizarVistaPrevia();
            });
        });

        /* ========== VALIDACIÓN EN TIEMPO REAL PARA EL RESTO DE INPUTS ========== */
        document.querySelectorAll('input:not([type="radio"]):not([type="checkbox"]):not([type="number"])').forEach(input => {
            if (!input.name.match(/apellidoPaterno|apellidoMaterno|nombres/)) {
                input.addEventListener('input', function () {
                    this.classList.remove('is-invalid');
                    actualizarVistaPrevia();
                });
            }
        });
    </script>
</body>

</html>